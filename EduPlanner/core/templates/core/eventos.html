{% extends 'core/base.html' %} {% block main %}
<h1>Crear Evento</h1>
<form method="post">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Crear</button>
</form>

<script>
    // URL de la API
    const tiposApiUrl = "http://127.0.0.1:8000/api/tipo_evento/";
    const eventosApiUrl = "http://127.0.0.1:8000/api/eventos/";
    const token = 'YOUR_AUTH_TOKEN'; // Reemplaza con tu token de autenticaci칩n

    // Cargar tipos de eventos al inicializar la p치gina
    async function cargarTipos() {
        try {
            const response = await fetch(tiposApiUrl, {
                headers: {
                    'Authorization': `Token ${token}`
                }
            });
            if (response.ok) {
                const tipos = await response.json();
                const tipoSelect = document.getElementById("tipo");

                // Agregar opciones al select
                tipos.forEach(tipo => {
                    const option = document.createElement("option");
                    option.value = tipo.id;
                    option.textContent = tipo.tipo;
                    tipoSelect.appendChild(option);
                });
            } else {
                console.error("Error al cargar los tipos de evento");
            }
        } catch (error) {
            console.error("Error al conectar con la API:", error);
        }
    }

    // Enviar datos del formulario
    document.getElementById("eventoForm").addEventListener("submit", async function (e) {
        e.preventDefault();

        // Capturar datos del formulario
        const data = {
            titulo: document.getElementById("titulo").value,
            descripcion: document.getElementById("descripcion").value,
            fecha_inicio: document.getElementById("fecha_inicio").value,
            fecha_fin: document.getElementById("fecha_fin").value,
            tipo: document.getElementById("tipo").value
        };

        try {
            const response = await fetch(eventosApiUrl, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    'Authorization': `Token ${token}`
                },
                body: JSON.stringify(data)
            });

            if (response.ok) {
                alert("Evento creado exitosamente");
                document.getElementById("eventoForm").reset();
            } else {
                const errorData = await response.json();
                console.error("Error al crear el evento:", errorData);
                alert("Hubo un error al crear el evento");
            }
        } catch (error) {
            console.error("Error al conectar con la API:", error);
            alert("No se pudo conectar con la API");
        }
    });

    // Llamar a la funci칩n para cargar los tipos de eventos al cargar la p치gina
    window.onload = cargarTipos;
</script>

{% endblock %}

