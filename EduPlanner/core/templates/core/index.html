{% extends 'core/base.html' %} {% block main %}
<h2>Home</h2>

<h1>Eventos</h1>

<!-- Add the filter select element here -->
<select id="tipo-filter">
  <option value="">Todos</option>
  <!-- We'll populate the options dynamically later -->
</select>

<table class="table table-striped">
  <thead>
    <tr>
      <th>Título</th>
      <th>Descripción</th>
      <th>Fecha de Inicio</th>
      <th>Fecha de Fin</th>
      <th>Tipo</th>
    </tr>
  </thead>
  <tbody id="eventos-table">
    <!-- data will be inserted here -->
  </tbody>
</table>

<script>
  // Get the table body element
  const tableBody = document.querySelector('#eventos-table');
  
  // Make an AJAX request to the API endpoint
  fetch('/api/eventos/')
    .then(response => response.json())
    .then(data => {
      // Make another AJAX request to fetch the tipo data
      fetch('/api/tipos_evento/')
        .then(response => response.json())
        .then(tiposData => {
          // Populate the filter select element options
          const tipoFilterSelect = document.getElementById('tipo-filter');
          tiposData.forEach(tipo => {
            const option = document.createElement('option');
            option.value = tipo.id;
            option.textContent = tipo.tipo;
            tipoFilterSelect.appendChild(option);
          });
          
          // Update the table with the received data
          data.forEach(evento => {
            const tipo = tiposData.find(tipo => tipo.id === evento.tipo);
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${evento.titulo}</td>
              <td>${evento.descripcion}</td>
              <td>${evento.fecha_inicio}</td>
              <td>${evento.fecha_fin}</td>
              <td>${tipo ? tipo.tipo : ''}</td>
            `;
            tableBody.appendChild(row);
          });
          
          // Add an event listener to the select element to filter the table
          tipoFilterSelect.addEventListener('change', function() {
            const selectedTipoId = this.value;
            const rows = tableBody.rows;
            
            // Hide all rows initially
            for (let i = 0; i < rows.length; i++) {
              rows[i].style.display = 'none';
            }
            
            // Show only the rows that match the selected tipo
            data.forEach(evento => {
    const tipo = tiposData.find(tipo => tipo.id === evento.tipo);
    if (selectedTipoId === '' || tipo.id === parseInt(selectedTipoId)) {
      const row = tableBody.querySelector(`tr:nth-child(${data.indexOf(evento) + 1})`);
      row.style.display = '';
    }
            });
          });
        });
    });
</script>

{% endblock %}